{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "ASEAN — Forest area (% of land) by country, 1990–2022",
  "width": 900,
  "height": 520,
  "projection": { "type": "equalEarth" },

  "params": [
    {
      "name": "Year",
      "value": 1990,
      "bind": { "input": "range", "min": 1990, "max": 2022, "step": 1 }
    }
  ],

  "layer": [
    {
      "data": {
        "url": "https://raw.githubusercontent.com/Xin-999/visualisation-vegalite/refs/heads/main/js/ne_110m_asean.topojson",
        "format": { "type": "topojson", "feature": "ne_110m_admin_0_countries" }
      },
      "mark": { "type": "geoshape", "fill": "#eee", "stroke": "white", "strokeWidth": 0.5 }
    },
    {
      "data": { "url": "https://raw.githubusercontent.com/Xin-999/visualisation-vegalite/refs/heads/main/data/forest_area_asean_long.csv" },
      "transform": [
        { "filter": "datum.Year == Year" },
        {
          "filter": "indexof(['BRN','KHM','IDN','LAO','MMR','MYS','PHL','SGP','THA','VNM'], datum['Country Code']) >= 0"
        },

        { "calculate": "datum['ForestArea'] / datum['Land Area(Sqkm)'] * 100",  "as": "ForestArea_percent" },
        { "calculate": "datum['ForestArea'] / datum['Land Area(Sqkm)'] * 1000", "as": "ForestArea_per_1000sqkm" },

        {
          "lookup": "Country Code",
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/Xin-999/visualisation-vegalite/refs/heads/main/js/ne_110m_asean.topojson",
              "format": { "type": "topojson", "feature": "ne_110m_admin_0_countries" }
            },
            "key": "properties.ISO_A3",
            "fields": ["geometry", "properties"]
          }
        }
      ],
      "mark": { "type": "geoshape", "stroke": "white", "strokeWidth": 0.5 },
      "encoding": {
        "shape": { "field": "geometry", "type": "geojson" },
        "color": {
          "field": "ForestArea_percent",
          "type": "quantitative",
          "title": "Forest area (% of land)",
          "scale": { "scheme": "greens" }
        },
        "tooltip": [
          { "field": "properties.NAME", "title": "Country" },
          { "field": "Year", "type": "ordinal" },
          { "field": "ForestArea", "type": "quantitative", "format": ",.0f", "title": "Forest area (km²)" },
          { "field": "ForestArea_pct", "type": "quantitative", "format": ".2f", "title": "Forest area (% of land)" },
          { "field": "ForestArea_per_1000sqkm", "type": "quantitative", "format": ".1f", "title": "per 1,000 km²" }
        ]
      }
    }
  ],

  "config": { "view": { "stroke": null } }
}
