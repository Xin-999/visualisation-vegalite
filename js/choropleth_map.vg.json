{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Forest Cover as a Percentage of Land Area in ASEAN Countries (1990–2022)",
  "width": 600,
  "height": 520,
  "projection": { "type": "equalEarth" },

  "params": [
    {
      "name": "Year",
      "value": 1990,
      "bind": { "input": "range", "min": 1990, "max": 2022, "step": 1 }
    }
  ],

  "layer": [
    {
      "data": {
        "url": "https://raw.githubusercontent.com/Xin-999/visualisation-vegalite/refs/heads/main/js/ne_10m_asean.topojson",
        "format": { "type": "topojson", "feature": "ne_10m_admin_0_countries" }
      },
      "mark": { "type": "geoshape", "fill": "#eee", "stroke": "white", "strokeWidth": 0.5 }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/Xin-999/visualisation-vegalite/refs/heads/main/js/ne_10m_asean.topojson",
        "format": { "type": "topojson", "feature": "ne_110m_graticules_20" }
      },
      "mark": { "type": "geoshape", "fill": null, "stroke": "#cbd5e1", "strokeWidth": 0.6 }
    },
    {
      "data": { "url": "https://raw.githubusercontent.com/Xin-999/visualisation-vegalite/refs/heads/main/data/forest_area_asean_long.csv" },
      "transform": [
        { "filter": "datum.Year == Year" },
        {
          "filter": "indexof(['BRN','KHM','IDN','LAO','MMR','MYS','PHL','SGP','THA','VNM'], datum['Country Code']) >= 0"
        },
        { "calculate": "datum['ForestArea'] / datum['Land Area(Sqkm)'] * 100",  "as": "ForestArea_percent" },
        { "calculate": "datum['ForestArea'] / datum['Land Area(Sqkm)'] * 1000", "as": "ForestArea_per_1000sqkm" },
        {
          "lookup": "Country Code",
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/Xin-999/visualisation-vegalite/refs/heads/main/js/ne_10m_asean.topojson",
              "format": { "type": "topojson", "feature": "ne_10m_admin_0_countries" }
            },
            "key": "properties.ISO_A3",
            "fields": ["geometry", "properties"]
          }
        }
      ],
      "mark": { "type": "geoshape" },
      "encoding": {
        "shape": { "field": "geometry", "type": "geojson" },
        "color": {
          "field": "ForestArea_percent",
          "type": "quantitative",
          "title": "Forest area (% of land)",
          "scale": {
            "type": "threshold",
            "domain": [30, 45, 65],
            "range": ["#e8f5e9", "#a5d6a7", "#66bb6a", "#2e7d32"]
          },
          "legend": {
            "orient": "right",
            "offset": 8,
            "labelExpr": "datum.label || (datum.value < 30 ? '< 30' : datum.value < 45 ? '30–44' : datum.value < 65 ? '45–64' : '≥ 65')"
          }
        },
        "tooltip": [
          { "field": "properties.NAME", "title": "Country" },
          { "field": "Year", "type": "ordinal" },
          { "field": "ForestArea", "type": "quantitative", "format": ",.0f", "title": "Forest area (km²)" },
          { "field": "ForestArea_percent", "type": "quantitative", "format": ".2f", "title": "Forest area (% of land)" },
          { "field": "ForestArea_per_1000sqkm", "type": "quantitative", "format": ".1f", "title": "per 1,000 km²" }
        ]
      }
    }
  ],

  "config": { "view": { "stroke": null } }
}
