{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "ASEAN • Forest area as % of land • 1990–2022",
  "width": 900,
  "height": 520,

  /* Regional projection with parameters (no 'world' default) */
  "projection": {
    "type": "mercator",
    "center": [110, 3],
    "scale": 850
  },

  "params": [
    {
      "name": "Year",
      "value": 1990,
      "bind": { "input": "range", "min": 1990, "max": 2022, "step": 1 }
    }
  ],

  "layer": [
    /* Oceans background */
    {
      "data": {
        "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/7_others/oceans.topojson",
        "format": { "type": "topojson", "feature": "oceans" }
      },
      "mark": { "type": "geoshape", "fill": "#e8f3fa" }
    },

    /* Graticules (30°) */
    {
      "data": {
        "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/2_symbol_map/js/WorldMapWithGraticules.topojson",
        "format": { "type": "topojson", "feature": "ne_10m_admin_0_countries" }
      },
      "mark": { "type": "geoshape", "stroke": "#cbd5e1", "strokeWidth": 0.6, "fill": null }
    },

    /* ASEAN basemap (light) — keeps the frame tight to the region (no empty space) */
    {
      "data": {
        "url": "https://raw.githubusercontent.com/Xin-999/visualisation-vegalite/main/js/ne_110m_asean.topojson",
        "format": { "type": "topojson", "feature": "ne_10m_admin_0_countries" }
      },
      "mark": { "type": "geoshape", "fill": "#f5f5f5", "stroke": "white", "strokeWidth": 0.6 }
    },

    /* Thematic layer (normalized) */
    {
      "data": {
        "url": "https://raw.githubusercontent.com/Xin-999/visualisation-vegalite/main/data/forest_area_asean_long.csv"
      },
      "transform": [
        { "filter": "datum.Year == Year" },
        {
          "filter": "indexof(['BRN','KHM','IDN','LAO','MMR','MYS','PHL','SGP','THA','VNM'], datum['Country Code']) >= 0"
        },

        /* Normalisation (percent of land and per 1,000 km²) */
        { "calculate": "datum['ForestArea'] / datum['Land Area(Sqkm)'] * 100",  "as": "ForestArea_percent" },
        { "calculate": "datum['ForestArea'] / datum['Land Area(Sqkm)'] * 1000", "as": "ForestArea_per_1000sqkm" },

        /* Join geometry by ISO3 */
        {
          "lookup": "Country Code",
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/Xin-999/visualisation-vegalite/main/js/ne_110m_asean.topojson",
              "format": { "type": "topojson", "feature": "ne_10m_admin_0_countries" }
            },
            "key": "properties.ISO_A3",
            "fields": ["geometry", "properties"]
          }
        }
      ],
      "mark": { "type": "geoshape", "stroke": "white", "strokeWidth": 0.8 },
      "encoding": {
        "shape": { "field": "geometry", "type": "geojson" },

        /* Sequential colour for a positive-only % attribute */
        "color": {
          "field": "ForestArea_percent",
          "type": "quantitative",
          "title": "Forest area (% of land)",
          "scale": { "scheme": "greens" }
        },

        /* Clear, human-readable tooltip (no raw field codes) */
        "tooltip": [
          { "field": "properties.NAME", "title": "Country" },
          { "field": "Year", "type": "ordinal" },
          { "field": "ForestArea", "type": "quantitative", "format": ",.0f", "title": "Forest area (km²)" },
          { "field": "ForestArea_percent", "type": "quantitative", "format": ".1f", "title": "Forest area (% of land)" },
          { "field": "ForestArea_per_1000sqkm", "type": "quantitative", "format": ".1f", "title": "per 1,000 km²" }
        ]
      }
    }
  ],

  "config": {
    "legend": { "orient": "right" },
    "view": { "stroke": null }
  }
}
