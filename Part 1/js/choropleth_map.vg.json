{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Forest Cover as a Percentage of Land Area in ASEAN Countries (1990–2022)",
  "width": 600,
  "height": 520,
  "projection": { "type": "equalEarth"},


  "params": [
    {
      "name": "Year",
      "value": 1990,
      "bind": { "input": "range", "min": 1990, "max": 2022, "step": 1 }
    }
  ],

  "layer": [
    {
      "data": {
        "url": "https://raw.githubusercontent.com/Xin-999/visualisation-vegalite/refs/heads/main/Part%201/js/ne_10m_asean.topojson",
        "format": { "type": "topojson", "feature": "ne_10m_admin_0_countries" }
      },
      "mark": { "type": "geoshape", "fill": "#eee", "stroke": "white", "strokeWidth": 0.5 }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/Xin-999/visualisation-vegalite/refs/heads/main/Part%201/js/ne_10m_asean.topojson",
        "format": { "type": "topojson", "feature": "ne_110m_graticules_20" }
      },
      "mark": { "type": "geoshape", "fill": null, "stroke": "#cbd5e1", "strokeWidth": 0.6 }
    },
    {
      "data": { "url": "https://raw.githubusercontent.com/Xin-999/visualisation-vegalite/refs/heads/main/Part%201/data/forest_area_asean_long.csv" },
      "transform": [
        { "filter": "datum.Year == Year" },
        {
          "filter": "indexof(['BRN','KHM','IDN','LAO','MMR','MYS','PHL','SGP','THA','VNM'], datum['Country Code']) >= 0"
        },
        { "calculate": "datum['ForestArea'] / datum['Land Area(Sqkm)'] * 100",  "as": "ForestArea_percent" },
        { "calculate": "datum['ForestArea'] / datum['Land Area(Sqkm)'] * 1000", "as": "ForestArea_per_1000sqkm" },
        {
          "lookup": "Country Code",
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/Xin-999/visualisation-vegalite/refs/heads/main/Part%201/js/ne_10m_asean.topojson",
              "format": { "type": "topojson", "feature": "ne_10m_admin_0_countries" }
            },
            "key": "properties.ISO_A3",
            "fields": ["geometry", "properties"]
          }
        }
      ],
      "mark": { "type": "geoshape" },
      "encoding": {
        "shape": { "field": "geometry", "type": "geojson" },
        "color": {
          "field": "ForestArea_percent",
          "type": "quantitative",
          "title": "Forest area (% of land)",
          "scale": {
            "type": "threshold",
            "domain": [30, 45, 65],
            "range": ["#edf8e9", "#bae4b3", "#74c476", "#238b45"]
          },
          "legend": {
            "orient": "right",
            "offset": 8,
            "labelExpr": "datum.value < 30 ? 'Low (<30%)' : datum.value < 45 ? 'Moderate (30–44%)' : datum.value < 65 ? 'High (45–64%)' : 'Very High (≥65%)'"
          }
        },
        "tooltip": [
          { "field": "properties.NAME", "title": "Country" },
          { "field": "Year", "type": "ordinal" },
          { "field": "ForestArea", "type": "quantitative", "format": ",.0f", "title": "Forest area (km²)" },
          { "field": "ForestArea_percent", "type": "quantitative", "format": ".2f", "title": "Forest area (% of land)" },
          { "field": "ForestArea_per_1000sqkm", "type": "quantitative", "format": ".1f", "title": "per 1,000 km²" }
        ]
      }
      
    },
    
    {
  "data": {
    "url": "https://raw.githubusercontent.com/Xin-999/visualisation-vegalite/refs/heads/main/js/ne_10m_asean.topojson",
    "format": { "type": "topojson", "feature": "ne_10m_admin_0_countries" }
  },
  "transform": [
    {
      "filter": "indexof(['BRN','KHM','IDN','LAO','MMR','MYS','PHL','SGP','THA','VNM'], datum.properties.ISO_A3) >= 0"
    },
    {
      "lookup": "properties.ISO_A3",
      "from": {
        "data": {
          "url": "https://raw.githubusercontent.com/Xin-999/visualisation-vegalite/refs/heads/main/Part%201/data/forest_area_asean_long.csv",
          "transform": [ { "filter": "datum.Year == Year" } ]   
        },
        "key": "Country Code",
        "fields": ["ForestArea","Land Area(Sqkm)","Year"]
      }
    },
    { "calculate": "datum['ForestArea'] / datum['Land Area(Sqkm)'] * 100", "as": "ForestArea_percent" }
  ],
  "mark": {
    "type": "text",
    "font": "serif",
    "fontSize": 10,
    "align": "center",
    "baseline": "middle"
  },
  "encoding": {
    "longitude": { "field": "properties.LABEL_X", "type": "quantitative" },
    "latitude":  { "field": "properties.LABEL_Y", "type": "quantitative" },
    "text":      { "field": "properties.NAME" },
    "color": {
      "condition": {
        "test": "isValid(datum.ForestArea_percent) && datum.ForestArea_percent >= 65",
        "value": "#D3D3D3"   
      },
      "value": "#71797E"    
    }
  }
}
  ],

  "config": { "view": { "stroke": null } }
}
